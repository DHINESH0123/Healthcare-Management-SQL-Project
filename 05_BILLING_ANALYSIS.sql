-- =========================================
-- SECTION: BILLING-ONLY ANALYSIS
-- PROJECT: HEALTHCARE SQL ANALYSIS
-- =========================================

-- TOTAL REVENUE
-- THIS QUERY CALCULATES THE TOTAL REVENUE GENERATED FROM ALL BILLING RECORDS.

SELECT SUM(AMOUNT) AS TOTAL_REVENUE FROM BILLING;

-- REVENUE BY PAYMENT STATUS
-- THIS QUERY CALCULATES REVENUE BASED ON PAYMENT STATUS SUCH AS PAID OR FAILED.

SELECT PAYMENT_STATUS, SUM(AMOUNT) AS REVENUE_BY_PAYMENT_STATUS
FROM BILLING
GROUP BY PAYMENT_STATUS;

-- REVENUE BY PAYMENT METHOD
-- THIS QUERY CALCULATES TOTAL REVENUE GENERATED BY EACH PAYMENT METHOD.

SELECT PAYMENT_METHOD, SUM(AMOUNT) AS REVENUE_BY_PAYMENT_METHODS
FROM BILLING
GROUP BY PAYMENT_METHOD;

-- AVERAGE BILLING AMOUNT
-- THIS QUERY CALCULATES THE AVERAGE BILL AMOUNT.

SELECT AVG(AMOUNT) AS AVERAGE_BILL_AMT FROM BILLING;

-- HIGHEST BILLING TRANSACTION
-- THIS QUERY IDENTIFIES THE HIGHEST BILL AMOUNT.

SELECT MAX(AMOUNT) AS HIGHEST_BILL_TRANSACTION FROM BILLING;

-- LOWEST BILLING TRANSACTION
-- THIS QUERY IDENTIFIES THE LOWEST BILL AMOUNT.

SELECT MIN(AMOUNT) AS LOWEST_BILL_TRANSACTION FROM BILLING;

-- NUMBER OF TRANSACTIONS PER PAYMENT METHOD
-- THIS QUERY COUNTS HOW MANY TRANSACTIONS OCCURRED FOR EACH PAYMENT METHOD.

SELECT PAYMENT_METHOD, COUNT(*) AS NO_OF_TRANSACTION
FROM BILLING
GROUP BY PAYMENT_METHOD;

-- PAID VS UNPAID BILL PERCENTAGE
-- THIS QUERY CALCULATES THE PERCENTAGE OF PAID AND UNPAID BILLS.

SELECT
    PAYMENT_STATUS, COUNT(*) AS BILL_COUNT,
    ROUND(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER (), 2) AS BILL_PERCENTAGE
FROM BILLING
GROUP BY PAYMENT_STATUS;

-- PAYMENT METHOD PREFERENCE ANALYSIS
-- THIS QUERY SHOWS WHICH PAYMENT METHODS ARE USED MORE FREQUENTLY.

SELECT PAYMENT_METHOD, COUNT(*) AS TRANSACTION_COUNT
FROM BILLING
GROUP BY PAYMENT_METHOD
ORDER BY TRANSACTION_COUNT;

-- IDENTIFY REVENUE CONCENTRATION (TOP BILLS)
-- THIS QUERY IDENTIFIES THE TOP 5 HIGHEST BILLING TRANSACTIONS.

SELECT BILL_ID, AMOUNT
FROM (
    SELECT BILL_ID, AMOUNT
    FROM BILLING
    ORDER BY AMOUNT DESC
)
WHERE ROWNUM <= 5;

-- BILLING TREND ANALYSIS
-- THIS QUERY ANALYZES REVENUE TRENDS BY DATE OR MONTH.

SELECT BILL_DATE, SUM(AMOUNT) AS DAILY_REVENUE
FROM BILLING
GROUP BY BILL_DATE;

-- OR MONTHLY BILLING TREND

SELECT TO_CHAR(BILL_DATE,'YYYY-MM') AS BILLING_MONTH,
       SUM(AMOUNT) AS MONTHLY_REVENUE
FROM BILLING
GROUP BY TO_CHAR(BILL_DATE,'YYYY-MM')
ORDER BY BILLING_MONTH;

-- IDENTIFY DELAYED PAYMENTS
-- THIS QUERY IDENTIFIES BILLS WHERE PAYMENT IS PENDING OR FAILED.

SELECT * FROM BILLING
WHERE PAYMENT_STATUS IN ('Pending','Failed');

-- REVENUE LEAKAGE FROM UNPAID BILLS
-- THIS QUERY CALCULATES REVENUE LOST DUE TO UNPAID OR FAILED BILLS.

SELECT SUM(AMOUNT) AS REVENUE_LEAKAGE
FROM BILLING
WHERE PAYMENT_STATUS IN ('Pending','Failed');

-- MOST RELIABLE PAYMENT METHOD
-- THIS QUERY IDENTIFIES THE PAYMENT METHOD WITH MOST SUCCESSFUL PAYMENTS.

SELECT PAYMENT_METHOD, PAYMENT_SUCCED AS MOST_RELIABLE_PAYMENT_METHOD
FROM (
    SELECT PAYMENT_METHOD, COUNT(PAYMENT_STATUS) AS PAYMENT_SUCCED
    FROM BILLING
    WHERE PAYMENT_STATUS = 'Paid'
    GROUP BY PAYMENT_METHOD
    ORDER BY PAYMENT_SUCCED DESC
)
WHERE ROWNUM = 1;

-- BILLING TRANSACTION DISTRIBUTION
-- THIS QUERY CLASSIFIES BILLING TRANSACTIONS INTO LOW, MEDIUM, AND HIGH VALUE.

SELECT
    CASE
        WHEN AMOUNT < 5000 THEN 'Low Value'
        WHEN AMOUNT BETWEEN 5000 AND 10000 THEN 'Medium Value'
        ELSE 'High Value'
    END AS BILL_CATEGORY,
    COUNT(*) AS TRANSACTION_COUNT
FROM BILLING
GROUP BY
    CASE
        WHEN AMOUNT < 5000 THEN 'Low Value'
        WHEN AMOUNT BETWEEN 5000 AND 10000 THEN 'Medium Value'
        ELSE 'High Value'
    END;
